{% extends 'base.html' %}

{% block title %}ãƒãƒ³ãƒ‰ãƒªãƒãƒ¼ã‚µãƒ«ç®¡ç† - ã‚¿ã‚¤ãƒãƒ¼{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1>ğŸµ ãƒãƒ³ãƒ‰ãƒªãƒãƒ¼ã‚µãƒ«ç®¡ç†</h1>
        <p class="text-muted">ç·´ç¿’ã‚¿ã‚¤ãƒãƒ¼ã‚’ç®¡ç†ã—ã¾ã™</p>
    </div>
    <div class="col-md-4 text-end">
        <a href="/admin/timer_core/timer/add/" class="btn btn-outline-success">ã‚¿ã‚¤ãƒãƒ¼è¿½åŠ </a>
        <a href="/admin/" class="btn btn-outline-secondary">ç®¡ç†ç”»é¢</a>
    </div>
</div>

{% if timers %}
    <!-- ã‚¿ã‚¤ãƒãƒ¼åˆ¶å¾¡ãƒ‘ãƒãƒ« -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">â° ã‚¿ã‚¤ãƒãƒ¼åˆ¶å¾¡</h5>
        </div>
        <div class="card-body text-center">
            <div class="timer-duration mb-3" id="current-timer">
                æº–å‚™å®Œäº†
            </div>
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-success btn-lg" id="start-btn">
                    <i class="bi bi-play-fill"></i> é–‹å§‹
                </button>
                <button type="button" class="btn btn-warning btn-lg" id="pause-btn" disabled>
                    <i class="bi bi-pause-fill"></i> ä¸€æ™‚åœæ­¢
                </button>
                <button type="button" class="btn btn-info btn-lg" id="skip-btn" disabled>
                    <i class="bi bi-skip-forward-fill"></i> ã‚¹ã‚­ãƒƒãƒ—
                </button>
                <button type="button" class="btn btn-secondary btn-lg" id="stop-btn" disabled>
                    <i class="bi bi-stop-fill"></i> åœæ­¢
                </button>
            </div>
            <div class="mt-3">
                <small class="text-muted">ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼: é–‹å§‹/ä¸€æ™‚åœæ­¢ | â†’ã‚­ãƒ¼: ã‚¹ã‚­ãƒƒãƒ—</small>
            </div>
        </div>
    </div>

    <!-- ã‚¿ã‚¤ãƒãƒ¼ä¸€è¦§ -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">ğŸ“‹ ã‚¿ã‚¤ãƒãƒ¼ä¸€è¦§ ({{ timers.count }}å€‹)</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>é †åº</th>
                        <th>ãƒãƒ³ãƒ‰å</th>
                        <th>æ™‚é–“</th>
                        <th>ç®¡ç†è€…</th>
                        <th>çŠ¶æ…‹</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for timer in timers %}
                    <tr class="timer-row" data-timer-id="{{ timer.id }}" data-duration="{{ timer.duration_minutes }}">
                        <td>
                            <span class="badge bg-secondary">{{ timer.order }}</span>
                        </td>
                        <td>
                            <strong>{{ timer.band.name }}</strong>
                        </td>
                        <td>
                            <span class="badge bg-primary">{{ timer.duration_minutes }}åˆ†</span>
                        </td>
                        <td>
                            {% if timer.manager1 %}
                                <span class="badge bg-info manager-badge me-1">{{ timer.manager1 }}</span>
                            {% endif %}
                            {% if timer.manager2 %}
                                <span class="badge bg-info manager-badge me-1">{{ timer.manager2 }}</span>
                            {% endif %}
                            {% if timer.manager3 %}
                                <span class="badge bg-info manager-badge">{{ timer.manager3 }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-light text-dark status-badge">å¾…æ©Ÿä¸­</span>
                        </td>
                        <td>
                            <a href="/admin/timer_core/timer/{{ timer.id }}/change/" class="btn btn-sm btn-outline-primary">ç·¨é›†</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- é€²æ—è¡¨ç¤º -->
    <div class="card mt-4">
        <div class="card-body">
            <h6>é€²æ—çŠ¶æ³</h6>
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: 0%" id="progress-bar">
                    0 / {{ timers.count }}
                </div>
            </div>
        </div>
    </div>

{% else %}
    <div class="alert alert-warning">
        <h4>ã‚¿ã‚¤ãƒãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</h4>
        <p>ã¾ãšã¯ãƒãƒ³ãƒ‰ã¨ã‚¿ã‚¤ãƒãƒ¼ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
        <a href="/admin/timer_core/band/add/" class="btn btn-primary me-2">ãƒãƒ³ãƒ‰ã‚’è¿½åŠ </a>
        <a href="/admin/timer_core/timer/add/" class="btn btn-outline-primary">ã‚¿ã‚¤ãƒãƒ¼ã‚’è¿½åŠ </a>
    </div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
// åŸºæœ¬çš„ãªJavaScriptï¼ˆPhase 2ã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¿ã‚¤ãƒãƒ¼ã¨é€£æºäºˆå®šï¼‰
document.addEventListener('DOMContentLoaded', function() {
    const startBtn = document.getElementById('start-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const skipBtn = document.getElementById('skip-btn');
    const stopBtn = document.getElementById('stop-btn');
    
    // åŸºæœ¬çš„ãªãƒœã‚¿ãƒ³åˆ¶å¾¡ã®ã¿ï¼ˆå®Ÿéš›ã®æ©Ÿèƒ½ã¯Phase 2ã§å®Ÿè£…ï¼‰
    startBtn.addEventListener('click', function() {
        alert('Phase 2ã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¿ã‚¤ãƒãƒ¼ã‚’å®Ÿè£…ã—ã¾ã™ï¼');
    });
    
    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    document.addEventListener('keydown', function(event) {
        if (event.code === 'Space') {
            event.preventDefault();
            startBtn.click();
        } else if (event.code === 'ArrowRight') {
            event.preventDefault();
            if (skipBtn.disabled === false) {
                skipBtn.click();
            }
        }
    });
});
</script>
{% endblock %}